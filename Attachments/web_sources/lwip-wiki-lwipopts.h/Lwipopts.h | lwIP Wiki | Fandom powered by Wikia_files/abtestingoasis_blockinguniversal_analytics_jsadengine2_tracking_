(function(window){var AbTest,Wikia=window.Wikia=(window.Wikia||{}),config=Wikia.AbTestConfig||{},logCache={},beacon=window.beacon_id||getCookie('wikia_beacon_id'),serverTimeString=window.varnishTime,serverDate=serverTimeString?new Date(serverTimeString):new Date(),serverTime=serverDate.getTime()/1000;var log=(function(console){return(console&&console.log)?function(methodName,message){if(!message){message=methodName;methodName=undefined;}
if(!logCache[message]){logCache[message]=true;console.log('Wikia.AbTest'+(methodName?'.'+methodName+'()':'')+':',message);}}:function(){};})(window.console);AbTest=function(expName){this.expName=expName;};AbTest.uuid=(function(uuid){var ret=uuid&&uuid!='ThisIsFake'?uuid:null;if(!ret){log('init','UUID is not available, A/B testing will be disabled');}
return ret;})(beacon);AbTest.getGroup=function(expName){var exp=getExperiment(expName,'getGroup'),group=exp&&exp.group;return group&&group.name;};AbTest.inGroup=function(expName,groupName){return AbTest.getGroup(expName)===groupName;};AbTest.isValidGroup=function(expName,groupName){var exp=getExperiment(expName,'isValidGroup'),current=exp&&exp.current;return!!(current&&current.groups[groupName]);};AbTest.getGASlot=function(expName){var exp=getExperiment(expName,'getGASlot'),current=exp&&exp.current,gaSlot=current&&current.gaSlot;return parseInt(gaSlot,10)||undefined;};AbTest.getExperiments=function(includeAll){var expName,exp,group,el,list=[];if(!AbTest.uuid){list.nouuid=true;}
for(expName in AbTest.experiments){exp=AbTest.experiments[expName];group=exp.group;if(!group&&!includeAll){continue;}
el={id:exp.id,name:exp.name,flags:exp.flags};if(group){el.group={id:group.id,name:group.name}}
list.push(el);}
return list;};AbTest.loadExternalData=function(data){var index,groupData,html='';log('init','Received external configuration');for(index in data){groupData=data[index];if(groupData.styles){html+='<style>'+groupData.styles+'</style>';}
if(groupData.scripts){html+='<script>'+groupData.scripts+'</script>';}}
if(html!=''){document.write(html);}};(function(prototype){var i,length,methodNames=['inGroup','getGroup','getGASlot','getUserSlot'];for(i=0,length=methodNames.length;i<length;i++){(function(methodName){prototype[methodName]=function(){return AbTest[methodName].apply(AbTest,[this.expName].concat(arguments));};})(methodNames[i]);}})(AbTest.prototype);function getExperiment(expName,methodName){if(!expName){log(methodName,'Missing required argument "expName".');}
var exp=AbTest.experiments[expName];if(!exp){log(methodName,'Experiment configuration not found for "'+expName+'."');}
return exp;}
function hash(s){var slot=0,i;for(i=0;i<s.length;i++){slot+=s.charCodeAt(i)*(i+1);}
return Math.abs(slot)%100;}
function getSlot(expName){return AbTest.uuid?hash(AbTest.uuid+expName):-1;}
function setActiveGroup(expName,groupName,force){var exp=getExperiment(expName,'setActiveGroup'),current=exp&&exp.current,group=current&&current.groups[groupName];if(group&&(!exp.group||force)){exp.group=group;return true;}
return false;}
function isInRanges(value,ranges){var i,range;if(!ranges||!ranges.length){return false;}
for(i=0;i<ranges.length;i++){range=ranges[i];if(value>=range.min&&value<=range.max){return true;}}
return false;}
function getCookie(name){if(!name){return null;}
return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(name).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null;}
AbTest.experiments=(function(experiments){var expName,exp,versions,version,i,activeExperiments={},count=0;for(expName in experiments){if(experiments.hasOwnProperty(expName)){exp=experiments[expName];versions=exp.versions;for(i=0;i<versions.length;i++){version=versions[i];if(serverTime>=version.startTime&&serverTime<version.endTime){exp.current=version;exp.flags=version.flags;count++;break;}}
if(exp.current){activeExperiments[expName]=exp;}}}
AbTest.experimentCount=count;return activeExperiments;})(config.experiments||{});(function(experiments){var matches,rTreatmentGroups=/AbTest\.([^=]+)=([^?&]+)/gi,queryString=window.location.search,expName,groupName,exp,slot,externalIds=[];if(queryString){while((matches=rTreatmentGroups.exec(queryString))!=null){expName=matches[1];groupName=matches[2];if(!AbTest.isValidGroup(expName,groupName)){log('init','Invalid experiment/group specified in URL: '+expName+'/'+groupName);continue;}
setActiveGroup(expName,groupName);}}
for(expName in experiments){exp=experiments[expName];slot=getSlot(expName);if(exp.group||!exp.current||slot<0){continue;}
if(exp.flags&&exp.flags.limit_to_special_wikis&&!window.wgIsGASpecialWiki){log('init','Skipping experiment '+expName+' - not a special Wiki');continue;}
for(groupName in exp.current.groups){if(isInRanges(slot,exp.current.groups[groupName].ranges)){setActiveGroup(expName,groupName);}}}
for(expName in experiments){exp=experiments[expName];if(exp.current.external&&exp.group){externalIds.push(exp.name+'.'+exp.current.id+'.'+exp.group.id);}}
if(externalIds.length>0&&!window.Mercury){log('init','Loading external configuration');var url=window.wgCdnApiUrl+'/wikia.php?controller=AbTesting&method=externalData&callback=Wikia.AbTest.loadExternalData&ids=';url+=externalIds.join(',');document.write('<scr'+'ipt src="'+encodeURI(url)+'"></script>');}})(AbTest.experiments);(function(experiments){var expName,exp;for(expName in experiments){exp=experiments[expName];if(Wikia.Tracker&&exp.flags&&exp.flags.dw_tracking&&exp.group){Wikia.Tracker.track({eventName:'ab_treatment',experiment:exp.name,experimentId:exp.id,time:serverTimeString,trackingMethod:'internal',treatmentGroup:exp.group.name,treatmentGroupId:exp.group.id});}}})(AbTest.experiments);Wikia.AbTest=AbTest;})(window);;


(function(context){'use strict';function lazyQueue(){function makeQueue(queue,callback){if(typeof callback!=='function'){throw new Error('LazyQueue used with callback not being a function');}else if(queue instanceof Array){queue.start=function(){while(queue.length>0){callback(queue.shift());}
queue.push=function(item){callback(item);};};return queue;}else{throw new Error('LazyQueue requires an array as the first parameter');}}
return{makeQueue:makeQueue};}
if(!context.Wikia){context.Wikia={};}
context.Wikia.LazyQueue=lazyQueue();if(context.define&&context.define.amd){context.define('wikia.lazyqueue',lazyQueue);}}(this));;


(function(window,undefined){'use strict';if(!window.wgNoExternals){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments);},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);})(window,document,'script','//www.google-analytics.com/analytics.js','ga');}else{window.ga=function(){};}
var cookieExists,isProductionEnv,blockingTracked={sourcePoint:false,pageFair:false},GASettings={sourcePoint:{trackName:'sourcePoint',name:'sourcepoint',dimension:6},pageFair:{trackName:'pageFair',dimension:7,name:'pagefair'}},listenerSettings=[{eventName:'sp.blocking',value:true,detectorSettings:GASettings.sourcePoint},{eventName:'sp.not_blocking',value:false,detectorSettings:GASettings.sourcePoint},{eventName:'pf.blocking',value:true,detectorSettings:GASettings.pageFair},{eventName:'pf.not_blocking',value:false,detectorSettings:GASettings.pageFair}];isProductionEnv=!window.wgGaStaging;cookieExists=function(cookieName){return document.cookie.indexOf(cookieName)>-1;};if(isProductionEnv){window.ga('create','UA-32129070-1','auto',{'sampleRate':(cookieExists('qualaroo_survey_submission')?100:10),'allowLinker':true,'userId':window.wgGAUserIdHash});}else{window.ga('create','UA-32129070-2','auto',{'sampleRate':(cookieExists('qualaroo_survey_submission')?100:10),'allowLinker':true,'userId':window.wgGAUserIdHash});}
if(window.wgIsGASpecialWiki){if(isProductionEnv){window.ga('create','UA-32132943-1','auto',{'name':'special','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}else{window.ga('create','UA-32132943-2','auto',{'name':'special','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}
window.ga('special.require','displayfeatures');}
if(window.wgGAUserIdHash){if(isProductionEnv){window.ga('create','UA-32132943-7','auto',{'name':'loggedin_users','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}else{window.ga('create','UA-32132943-8','auto',{'name':'loggedin_users','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});window.ga('loggedin_users.require','displayfeatures');}}
if(isProductionEnv){window.ga('create','UA-32132943-4','auto',{'name':'ve','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});window.ga('ve.require','displayfeatures');}
window.ga('require','displayfeatures');function _gaWikiaPush(commands){var i,spec,args=Array.prototype.slice.call(arguments);for(i=0;i<args.length;i++){if(typeof args[i]==='function'){window.ga(args[i]);continue;}else if(args[i][0]==='send'&&args[i].length===7){args[i][6]={'nonInteraction':args[i][6]};}
window.ga.apply(window,args[i]);if(args[i][0].indexOf('.')===-1){if(window.wgIsGASpecialWiki){spec=args[i].slice();spec[0]='special.'+spec[0];window.ga.apply(window,spec);}
if(window.wgGAUserIdHash){spec=args[i].slice();spec[0]='loggedin_users.'+spec[0];window.ga.apply(window,spec);}
if(args[i][1]&&args[i][1]==='editor-ve'){spec=args[i].slice();spec[0]='ve.'+spec[0];window.ga.apply(window,spec);}}}}
function getEsrbRating(){var rating='not set';if(window.ads&&window.ads.context.targeting.esrbRating){rating=window.ads.context.targeting.esrbRating;}
return rating;}
function getKruxSegment(){var kruxSegment='not set',uniqueKruxSegments={ocry7a4xg:'Game Heroes 2014',ocr1te1tc:'Digital DNA 2014',ocr6m2jd6:'Inquisitive Minds 2014',ocr05ve5z:'Culture Caster 2014',ocr88oqh9:'Social Entertainers 2014'},uniqueKruxSegmentsKeys=Object.keys(uniqueKruxSegments),markedSegments=[],kruxSegments=[];if(window.localStorage){kruxSegments=(window.localStorage.kxsegs||'').split(',');}
if(kruxSegments.length){markedSegments=uniqueKruxSegmentsKeys.filter(function(n){return kruxSegments.indexOf(n)!==-1;});if(markedSegments.length){kruxSegment=uniqueKruxSegments[markedSegments[0]];}}
return kruxSegment;}
function trackBlocking(detectorSettings,isBlocked){var value=isBlocked?'Yes':'No';if(blockingTracked[detectorSettings.trackName]){return;}
blockingTracked[detectorSettings.trackName]=true;_gaWikiaPush(['set','dimension'+detectorSettings.dimension,value]);window.ga('ads.set','dimension'+detectorSettings.dimension,value);guaTrackAdEvent('ad/'+detectorSettings.name+'/detection',value,'',0,true);guaTrackEvent('ads-'+detectorSettings.name+'-detection','impression',value,0,true);}
_gaWikiaPush(['set','dimension1',window.wgDBname],['set','dimension2',window.wgContentLanguage],['set','dimension3',window.cscoreCat],['set','dimension4',window.skin],['set','dimension5',!!window.wgUserName?'user':'anon']);function getUnconfirmedEmailUserType(){if(!window.wgUserName){return'anon';}else{switch(window.wgNotConfirmedEmail){case'1':return'unconfirmed';case'2':return'confirmed';default:return'old user';}}}
_gaWikiaPush(['set','dimension8',window.wikiaPageType],['set','dimension9',window.wgCityId],['set','dimension13',getEsrbRating()],['set','dimension14',window.wgGaHasAds?'Yes':'No'],['set','dimension15',window.wikiaPageIsCorporate?'Yes':'No'],['set','dimension16',getKruxSegment()],['set','dimension17',window.wgWikiVertical],['set','dimension18',window.wgWikiCategories.join(',')],['set','dimension19',window.wgArticleType],['set','dimension20',window.wgABPerformanceTest||'not set'],['set','dimension21',String(window.wgArticleId)],['set','dimension23',window.wikiaIsPowerUserFrequent?'Yes':'No'],['set','dimension24',window.wikiaIsPowerUserLifetime?'Yes':'No'],['set','dimension25',String(window.wgNamespaceNumber)],['set','dimension26',String(window.wgSeoTestingBucket||0)]);_gaWikiaPush(['set','dimension39',getUnconfirmedEmailUserType()]);function isOptimizelyLoadedAndActive(){var optimizely=window.optimizely;return optimizely&&optimizely.activeExperiments&&Array.isArray(optimizely.activeExperiments)&&optimizely.activeExperiments.length>0&&typeof optimizely.allExperiments==='object'&&Object.keys(optimizely.allExperiments).length>0&&typeof optimizely.variationNamesMap==='object'&&Object.keys(optimizely.variationNamesMap).length>0;}
if(isOptimizelyLoadedAndActive()){var optimizely=window.optimizely;optimizely.activeExperiments.forEach(function(experimentId){if(optimizely.allExperiments.hasOwnProperty(experimentId)&&typeof optimizely.allExperiments[experimentId].universal_analytics==='object'){var dimension=optimizely.allExperiments[experimentId].universal_analytics.slot,experimentName=optimizely.allExperiments[experimentId].name,variationName=optimizely.variationNamesMap[experimentId];_gaWikiaPush(['set','dimension'+dimension,'Optimizely '+experimentName+' ('+experimentId+'): '+variationName]);}});}
if(window.Wikia&&window.Wikia.AbTest){var abList=window.Wikia.AbTest.getExperiments(true),abExp,abGroupName,abSlot,abIndex,abForceTrackOnLoad=false,abCustomVarsForAds=[];for(abIndex=0;abIndex<abList.length;abIndex++){abExp=abList[abIndex];if(!abExp||!abExp.flags){continue;}
if(!abExp.flags.ga_tracking){continue;}
if(abExp.flags.forced_ga_tracking_on_load&&abExp.group){abForceTrackOnLoad=true;}
abSlot=window.Wikia.AbTest.getGASlot(abExp.name);if(abSlot>=40&&abSlot<=49){abGroupName=abExp.group?abExp.group.name:(abList.nouuid?'NOBEACON':'NOT_IN_ANY_GROUP');_gaWikiaPush(['set','dimension'+abSlot,abGroupName]);abCustomVarsForAds.push(['ads.set','dimension'+abSlot,abGroupName]);}}
if(abForceTrackOnLoad){var abRenderStart=window.wgNow||(new Date()),abOnLoadHandler;abOnLoadHandler=function(){var renderTime=(new Date()).getTime()-abRenderStart.getTime();setTimeout(function(){window.guaTrackEvent('ABtest','ONLOAD','TIME',renderTime);},10);};if(window.attachEvent){window.attachEvent('onload',abOnLoadHandler);}else if(window.addEventListener){window.addEventListener('load',abOnLoadHandler,false);}}}
_gaWikiaPush(['send','pageview']);if(window.ads&&window.ads.context.opts.showAds){listenerSettings.map(function(listenerSetting){document.addEventListener(listenerSetting.eventName,function(){trackBlocking(listenerSetting.detectorSettings,listenerSetting.value);});});}
if(isProductionEnv){window.ga('create','UA-32129071-1','auto',{'name':'ads','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}else{window.ga('create','UA-32129071-2','auto',{'name':'ads','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}
window.ga('ads.require','displayfeatures');window.ga('ads.set','dimension1',window.wgDBname);window.ga('ads.set','dimension2',window.wgContentLanguage);window.ga('ads.set','dimension3',window.cscoreCat);window.ga('ads.set','dimension4',window.skin);window.ga('ads.set','dimension5',!!window.wgUserName?'user':'anon');window.ga('ads.set','dimension8',window.wikiaPageType);window.ga('ads.set','dimension9',window.wgCityId);window.ga('ads.set','dimension13',getEsrbRating());window.ga('ads.set','dimension14',window.wgGaHasAds?'Yes':'No');window.ga('ads.set','dimension15',window.wikiaPageIsCorporate?'Yes':'No');window.ga('ads.set','dimension16',getKruxSegment());window.ga('ads.set','dimension17',window.wgWikiVertical);window.ga('ads.set','dimension18',window.wgWikiCategories.join(','));window.ga('ads.set','dimension19',window.wgArticleType);window.ga('ads.set','dimension20',window.wgABPerformanceTest||'not set');window.ga('ads.set','dimension21',String(window.wgArticleId));window.ga('ads.set','dimension23',window.wikiaIsPowerUserFrequent?'Yes':'No');window.ga('ads.set','dimension24',window.wikiaIsPowerUserLifetime?'Yes':'No');window.ga('ads.set','dimension25',String(window.wgNamespaceNumber));window.ga('ads.set','dimension26',String(window.wgSeoTestingBucket||0));if(window.Wikia&&window.Wikia.AbTest){var i;for(i=0;i<abCustomVarsForAds.length;i++){window.ga.apply(window,abCustomVarsForAds[i]);}}
window.guaTrackAdEvent=function(category,action,opt_label,opt_value,opt_noninteractive){var args,adHitSample=1;if(Math.random()*100<=adHitSample){args=Array.prototype.slice.call(arguments);if(args.length===5){args[4]={'nonInteraction':args[4]};}
args.unshift('ads.send','event');try{window.ga.apply(window,args);}catch(e){}}};window.guaTrackEvent=function(category,action,opt_label,opt_value,opt_noninteractive){var args=Array.prototype.slice.call(arguments);args.unshift('send','event');try{_gaWikiaPush(args);}catch(e){}};window.guaTrackPageview=function(fakePage,opt_namespace){var nsPrefix=(opt_namespace)?opt_namespace+'.':'';_gaWikiaPush([nsPrefix+'send','pageview',fakePage]);};}(window));;


define('ext.wikia.adEngine.adLogicPageParams',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adLogicPageViewCounter','ext.wikia.adEngine.utils.adLogicZoneParams','wikia.document','wikia.geo','wikia.location','wikia.log','wikia.window',require.optional('wikia.abTest'),require.optional('wikia.krux')],function(adContext,pvCounter,zoneParams,doc,geo,loc,log,win,abTest,krux){'use strict';var context={},logGroup='ext.wikia.adEngine.adLogicPageParams',runtimeParams={},skin=adContext.getContext().targeting.skin;function updateContext(){context=adContext.getContext();}
function getAb(){var experiments,experimentsNumber,i,ab=[];if(abTest){experiments=abTest.getExperiments();experimentsNumber=experiments.length;for(i=0;i<experimentsNumber;i+=1){ab.push(experiments[i].id+'_'+experiments[i].group.id);}}
return ab;}
function getPerformanceAb(){return win.wgABPerformanceTest;}
function extend(target,obj){var key;for(key in obj){if(obj.hasOwnProperty(key)){target[key]=obj[key];}}
return target;}
function addParam(key,value){runtimeParams[key]=value;}
function decodeLegacyDartParams(dartString){var params={},kvs,kv,key,value,i,len;log(['decodeLegacyDartParams',dartString],9,logGroup);if(typeof dartString==='string'){kvs=dartString.split(';');for(i=0,len=kvs.length;i<len;i+=1){kv=kvs[i].split('=');key=kv[0];value=kv[1];if(key&&value&&key!=='esrb'){params[key]=params[key]||[];params[key].push(value);}}}
return params;}
function getRefParam(){var hostnameMatch,ref=doc.referrer,refHostname,searchDomains=/(google|search\.yahooo|bing|baidu|ask|yandex)/,wikiDomains=['wikia.com','ffxiclopedia.org','jedipedia.de','memory-alpha.org','uncyclopedia.org','websitewiki.de','wowwiki.com','yoyowiki.org'],wikiDomainsRegex=new RegExp('(^|\\.)('+wikiDomains.join('|').replace(/\./g,'\\.')+')$');if(!ref||typeof ref!=='string'){return'direct';}
refHostname=ref.match(/\/\/([^\/]+)\//);if(refHostname){refHostname=refHostname[1];}
hostnameMatch=refHostname===loc.hostname;if(hostnameMatch&&ref.indexOf('search=')>-1){return'wiki_search';}
if(hostnameMatch){return'wiki';}
hostnameMatch=wikiDomainsRegex.test(refHostname);if(hostnameMatch&&ref.indexOf('search=')>-1){return'wikia_search';}
if(hostnameMatch){return'wikia';}
if(searchDomains.test(refHostname)){return'external_search';}
return'external';}
function getAspectRatio(){return win.innerWidth>win.innerHeight?'4:3':'3:4';}
function getPageLevelParams(options){log('getPageLevelParams',9,logGroup);var params,targeting=context.targeting,pvs=pvCounter.get();options=options||{};params={s0:zoneParams.getSite(),s0v:zoneParams.getVertical(),s0c:zoneParams.getWikiCategories(),s1:zoneParams.getName(),s2:zoneParams.getPageType(),ab:getAb(),ar:getAspectRatio(),perfab:getPerformanceAb(),artid:targeting.pageArticleId&&targeting.pageArticleId.toString(),cat:zoneParams.getPageCategories(),dmn:zoneParams.getDomain(),hostpre:zoneParams.getHostnamePrefix(),skin:targeting.skin,lang:zoneParams.getLanguage(),wpage:targeting.pageName&&targeting.pageName.toLowerCase(),ref:getRefParam(),esrb:targeting.esrbRating,geo:geo.getCountryCode()||'none'};if(pvs){params.pv=pvs.toString();}
if(options.includeRawDbName){params.rawDbName=zoneParams.getRawDbName();}
if(krux&&targeting.enableKruxTargeting){params.u=krux.getUser();params.ksgmnt=krux.getSegments();}
if(targeting.wikiIsTop1000){params.top='1k';}
extend(params,decodeLegacyDartParams(targeting.wikiCustomKeyValues));extend(params,runtimeParams);log(params,9,logGroup);return params;}
if(skin&&skin!=='mercury'){pvCounter.increment();}
updateContext();adContext.addCallback(updateContext);return{add:addParam,getPageLevelParams:getPageLevelParams};});;define('ext.wikia.adEngine.adLogicPageViewCounter',['wikia.cache','wikia.window'],function(cache,window){'use strict';var cacheKey='adEngine_pageViewCounter',cacheTtl=24*3600*1000,now=window.wgNow||new Date(),initialValue={since:now.getTime(),pvs:0};function isValidValue(val){if(!val||isNaN(val.since)||isNaN(val.pvs)){return false;}
var pvs=val.pvs,age=now.getTime()-val.since;if(pvs<0||age<0||age>cacheTtl){return false;}
return true;}
function get(){var val=cache.get(cacheKey,now);if(!isValidValue(val)){val=initialValue;}
return val.pvs;}
function increment(){var val,age,ttlLeft;val=cache.get(cacheKey,now);if(!isValidValue(val)){val=initialValue;}
age=now.getTime()-val.since;ttlLeft=cacheTtl-age;val.pvs+=1;cache.set(cacheKey,val,ttlLeft,now);}
return{get:get,increment:increment};});;define('ext.wikia.adEngine.adTracker',['ext.wikia.adEngine.utils.timeBuckets','wikia.tracker','wikia.window','wikia.log'],function(timeBuckets,tracker,win,log){'use strict';var buckets=[0.0,0.5,1.0,1.5,2.0,2.5,3.5,5.0,8.0,20.0,60.0],logGroup='ext.wikia.adEngine.adTracker';function encodeAsQueryString(extraParams){var out=[],key,keys=[],i,len;if(win.ads&&win.ads.runtime.sp&&typeof win.ads.runtime.sp.blocking==='boolean'){extraParams.sp=win.ads.runtime.sp.blocking?'yes':'no';}
if(win.ads&&win.ads.runtime.pf&&typeof win.ads.runtime.pf.blocking==='boolean'){extraParams.pf=win.ads.runtime.pf.blocking?'yes':'no';}
for(key in extraParams){if(extraParams.hasOwnProperty(key)){keys.push(key);}}
keys.sort();for(i=0,len=keys.length;i<len;i+=1){key=keys[i];out.push(key+'='+extraParams[key]);}
return out.join(';');}
function track(eventName,data,value,forcedLabel){var category='ad/'+eventName,action=typeof data==='string'?data:encodeAsQueryString(data||{}),gaLabel=forcedLabel,gaValue,trackValue;if(!gaLabel){if(value===undefined){gaLabel='';value=0;}else{gaLabel=timeBuckets.getTimeBucket(buckets,value/1000);if(/\+$|invalid/.test(gaLabel)){category=category.replace('ad','ad/error');}}}
gaValue=Math.round(value);action=action||'nodata';trackValue={ga_category:category,ga_action:action,ga_label:gaLabel,ga_value:isNaN(gaValue)?0:gaValue,trackingMethod:'ad'};tracker.track(trackValue);log(trackValue,'debug',logGroup);}
function trackDW(data,eventName){var trackValue={eventName:eventName,trackingMethod:'internal'};if(typeof data==='string'){trackValue.ping=data;}else{Object.keys(data).forEach(function(key){trackValue[key]=data[key];});}
tracker.track(trackValue);log(['trackDW',trackValue],'debug',logGroup);}
function measureTime(eventName,eventData,eventType){var timingValue=win.wgNow&&new Date().getTime()-win.wgNow.getTime();eventType=eventType?'/'+eventType:'';return{measureDiff:function(diffData,diffType){eventType='/'+diffType;eventData=diffData;timingValue=win.wgNow&&new Date().getTime()-win.wgNow.getTime()-timingValue;return{track:this.track};},track:function(){if(timingValue){track('timing/'+eventName+eventType,eventData,timingValue);}}};}
return{track:track,trackDW:trackDW,measureTime:measureTime};});;define('ext.wikia.adEngine.utils.sampler',function(){'use strict';function sample(partToSample,all){return getRandomInt(0,all)<partToSample;}
function getRandomInt(min,max){return Math.floor(Math.random()*(max-min))+min;}
return{sample:sample};});;define('ext.wikia.adEngine.utils.timeBuckets',function(){function getTimeBucket(timeBuckets,time){var i,len=timeBuckets.length,bucket;for(i=0;i<len;i+=1){if(time>=timeBuckets[i]){bucket=i;}}
if(bucket===len-1){return timeBuckets[bucket]+'+';}
if(bucket>=0){return timeBuckets[bucket]+'-'+timeBuckets[bucket+1];}
return'invalid';}
return{getTimeBucket:getTimeBucket}});;define('ext.wikia.adEngine.adContext',['wikia.abTest','wikia.cookies','wikia.document','wikia.geo','wikia.instantGlobals','ext.wikia.adEngine.utils.sampler','wikia.window','wikia.querystring'],function(abTest,cookies,doc,geo,instantGlobals,sampler,w,Querystring){'use strict';instantGlobals=instantGlobals||{};var context,callbacks=[],qs=new Querystring();function getContext(){return context;}
function getMercuryCategories(){if(!context.targeting.mercuryPageCategories){return;}
return context.targeting.mercuryPageCategories.map(function(item){return item.title;});}
function isUrlParamSet(param){return!!parseInt(qs.getVal(param,'0'),10);}
function isPageType(pageType){return context.targeting.pageType===pageType;}
function setContext(newContext){var i,len,noExternals=w.wgNoExternals||isUrlParamSet('noexternals'),taboolaConfig=instantGlobals.wgAdDriverTaboolaConfig||{};context=newContext;context.opts=context.opts||{};context.slots=context.slots||{};context.targeting=context.targeting||{};context.providers=context.providers||{};context.forcedProvider=qs.getVal('forcead',null)||context.forcedProvider||null;context.opts.noExternals=noExternals;if(doc&&doc.referrer&&doc.referrer.match(/info\.tvsideview\.sony\.net/)){context.opts.showAds=false;}
if(geo.isProperGeo(instantGlobals.wgAdDriverDelayCountries)){context.opts.delayEngine=true;}
if(!noExternals){var geoIsSupported=geo.isProperGeo(instantGlobals.wgAdDriverPageFairDetectionCountries),forcePageFairByURL=isUrlParamSet('pagefairdetection'),canBeSampled=sampler.sample(1,10);if(forcePageFairByURL||(geoIsSupported&&canBeSampled)){context.opts.pageFairDetection=true;}}
if(!noExternals&&context.opts.sourcePointRecovery!==false&&geo.isProperGeo(instantGlobals.wgAdDriverSourcePointRecoveryCountries)){context.opts.sourcePointRecovery=true;}
if(noExternals&&context.opts.sourcePointMMS===true){context.opts.sourcePointMMS=false;}
if(context.opts.sourcePointMMS||context.opts.sourcePointRecovery){context.opts.sourcePointBootstrap=true;}
if(!noExternals&&context.opts.sourcePointDetectionUrl){context.opts.sourcePointDetection=(context.targeting.skin==='oasis'&&geo.isProperGeo(instantGlobals.wgAdDriverSourcePointDetectionCountries));context.opts.sourcePointDetectionMobile=(context.targeting.skin==='mercury'&&geo.isProperGeo(instantGlobals.wgAdDriverSourcePointDetectionMobileCountries));}
if(!noExternals){if(shouldLoadTaboolaOnBlockingTraffic(taboolaConfig)){context.opts.loadTaboolaLibrary=true;}}
if(context.opts.sourcePointDetection&&!context.opts.sourcePointRecovery&&context.opts.showAds){context.opts.googleConsumerSurveys=abTest.getGroup('PROJECT_43')==='GROUP_5'&&geo.isProperGeo(instantGlobals.wgAdDriverGoogleConsumerSurveysCountries);}
if(cookies.get('mock-ads')==='NlfdjR5xC0'){context.opts.showcase=true;}
if(context.targeting.enablePageCategories){context.targeting.pageCategories=w.wgCategories||getMercuryCategories();}
if(context.providers.evolve2){context.providers.evolve2=geo.isProperGeo(instantGlobals.wgAdDriverEvolve2Countries);}
if(geo.isProperGeo(instantGlobals.wgAdDriverTurtleCountries)){context.providers.turtle=true;}
if(context.providers.rubiconFastlane){context.providers.rubiconFastlane=geo.isProperGeo(instantGlobals.wgAdDriverRubiconFastlaneCountries)&&geo.isProperGeo(instantGlobals.wgAdDriverRubiconFastlaneProviderCountries);}
context.slots.invisibleHighImpact=(context.slots.invisibleHighImpact&&geo.isProperGeo(instantGlobals.wgAdDriverHighImpactSlotCountries))||isUrlParamSet('highimpactslot');context.opts.incontentLeaderboardAsOutOfPage=geo.isProperGeo(instantGlobals.wgAdDriverIncontentLeaderboardOutOfPageSlotCountries);context.opts.scrollHandlerConfig=instantGlobals.wgAdDriverScrollHandlerConfig;context.opts.enableScrollHandler=geo.isProperGeo(instantGlobals.wgAdDriverScrollHandlerCountries)||isUrlParamSet('scrollhandler');context.opts.enableAdInfoLog=geo.isProperGeo(instantGlobals.wgAdDriverKikimoraTrackingCountries);context.targeting.enableKruxTargeting=!!(context.targeting.enableKruxTargeting&&geo.isProperGeo(instantGlobals.wgAdDriverKruxCountries)&&!instantGlobals.wgSitewideDisableKrux);context.opts.floatingMedrec=!!(context.opts.showAds&&context.opts.adsInContent&&(isPageType('article')||isPageType('search'))&&!context.targeting.wikiIsCorporate);context.opts.overridePrefootersSizes=!!(context.targeting.skin==='oasis'&&geo.isProperGeo(instantGlobals.wgAdDriverOverridePrefootersCountries)&&!isPageType('home'));context.opts.openXRemnantEnabled=geo.isProperGeo(instantGlobals.wgAdDriverOpenXBidderCountriesRemnant);context.opts.yavli=!!(!noExternals&&geo.isProperGeo(instantGlobals.wgAdDriverYavliCountries)&&isPageType('article'));context.providers.revcontent=!noExternals&&geo.isProperGeo(instantGlobals.wgAdDriverRevcontentCountries);if(w.ads&&w.ads.context){w.ads.context=context;}
for(i=0,len=callbacks.length;i<len;i+=1){callbacks[i](context);}}
function shouldLoadTaboolaOnBlockingTraffic(taboolaConfig){var i,taboolaSlot;for(taboolaSlot in taboolaConfig){if(taboolaConfig.hasOwnProperty(taboolaSlot)&&taboolaConfig[taboolaSlot].recovery){for(i=0;i<taboolaConfig[taboolaSlot].recovery.length;i++){if(geo.isProperGeo(taboolaConfig[taboolaSlot].recovery[i])){return true;}}}}
return false;}
function addCallback(callback){callbacks.push(callback);}
setContext(w.ads?w.ads.context:{});return{addCallback:addCallback,getContext:getContext,setContext:setContext};});;define('ext.wikia.adEngine.context.slotsContext',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.utils.adLogicZoneParams','wikia.geo','wikia.instantGlobals','wikia.log'],function(adContext,params,geo,instantGlobals,log){'use strict';var logGroup='ext.wikia.adEngine.context.slotsContext',slots={};function setStatus(slotName,status){slots[slotName]=!!status;}
function setupSlots(){var context=adContext.getContext(),isHome=params.getPageType()==='home';setStatus('HOME_TOP_LEADERBOARD',isHome);setStatus('HOME_TOP_RIGHT_BOXAD',isHome);setStatus('PREFOOTER_MIDDLE_BOXAD',isHome);setStatus('TOP_LEADERBOARD',!isHome);setStatus('TOP_RIGHT_BOXAD',!isHome);setStatus('LEFT_SKYSCRAPER_2',!isHome);setStatus('LEFT_SKYSCRAPER_3',!isHome);setStatus('INCONTENT_BOXAD_1',!isHome);setStatus('INVISIBLE_HIGH_IMPACT_2',geo.isProperGeo(instantGlobals.wgAdDriverHighImpact2SlotCountries));setStatus('INCONTENT_LEADERBOARD',geo.isProperGeo(instantGlobals.wgAdDriverIncontentLeaderboardSlotCountries));setStatus('INCONTENT_PLAYER',geo.isProperGeo(instantGlobals.wgAdDriverIncontentPlayerSlotCountries));setStatus('PREFOOTER_RIGHT_BOXAD',!context.opts.overridePrefootersSizes);log(['Disabled slots:',slots],'info',logGroup);}
function isApplicable(slotName){return slots[slotName]!==false;}
function filterSlotMap(slotMap){var map={};Object.keys(slotMap).forEach(function(slotName){if(isApplicable(slotName)){map[slotName]=slotMap[slotName];}});return map;}
setupSlots();adContext.addCallback(function(){setupSlots();});return{filterSlotMap:filterSlotMap,isApplicable:isApplicable};});;define('ext.wikia.adEngine.lookup.lookupFactory',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adTracker','ext.wikia.aRecoveryEngine.recovery.helper','wikia.lazyqueue','wikia.log'],function(adContext,adTracker,helper,lazyQueue,log){'use strict';function create(module){var called=false,onResponseCallbacks=[],response=false,timing,context=adContext.getContext();function onResponse(){log('onResponse','debug',module.logGroup);timing.measureDiff({},'end').track();module.calculatePrices();response=true;onResponseCallbacks.start();if(module.name==='prebid'){module.trackAdaptersOnLookupEnd();}else{adTracker.track(module.name+'/lookup_end',module.getPrices(),0,'nodata');}}
function addResponseListener(callback){onResponseCallbacks.push(callback);}
function call(){log('call','debug',module.logGroup);response=false;if(!Object.keys){log(['call','Module is not supported in IE8',module.name],'debug',module.logGroup);return;}
timing=adTracker.measureTime(module.name,{},'start');timing.track();module.call(context.targeting.skin||'mercury',onResponse);called=true;helper.addOnBlockingCallback(onResponseCallbacks.start);}
function wasCalled(){log(['wasCalled',called],'debug',module.logGroup);return called;}
function trackState(providerName,slotName,params){log(['trackState',response,providerName,slotName],'debug',module.logGroup);var category,encodedParams,eventName;if(!module.isSlotSupported(slotName)){log(['trackState','Not supported slot',slotName],'debug',module.logGroup);return;}
if(module.name==='prebid'){module.trackAdaptersSlotState(providerName,slotName,params);}else{encodedParams=module.encodeParamsForTracking(params);eventName=encodedParams?'lookup_success':'lookup_error';category=module.name+'/'+eventName+'/'+providerName;adTracker.track(category,slotName,0,encodedParams||'nodata');}}
function getSlotParams(slotName){log(['getSlotParams',slotName,called,response],'debug',module.logGroup);if(!called||!module.isSlotSupported(slotName)){log(['getSlotParams','Not called or slot is not supported',slotName],'debug',module.logGroup);return{};}
return module.getSlotParams(slotName);}
function getBestSlotPrice(slotName){if(module.getBestSlotPrice){return module.getBestSlotPrice(slotName);}
return{};}
function getName(){return module.name;}
function hasResponse(){log(['hasResponse',response],'debug',module.logGroup);return response;}
lazyQueue.makeQueue(onResponseCallbacks,function(callback){callback();});return{addResponseListener:addResponseListener,call:call,getBestSlotPrice:getBestSlotPrice,getName:getName,getSlotParams:getSlotParams,hasResponse:hasResponse,trackState:trackState,wasCalled:wasCalled};}
return{create:create};});;define('ext.wikia.adEngine.slot.adSlot',['wikia.document','wikia.log','wikia.window',require.optional('ext.wikia.aRecoveryEngine.recovery.helper')],function(doc,log,win,recoveryHelper){'use strict';var logGroup='ext.wikia.adEngine.slot.adSlot';function create(name,container,callbacks){function registerHook(name){return function(adInfo){if(typeof callbacks[name]==='function'){callbacks[name](adInfo);}}}
return{name:name,container:container,collapse:registerHook('collapse'),hop:registerHook('hop'),renderEnded:registerHook('renderEnded'),success:registerHook('success')}}
function getShortSlotName(slotName){return slotName.replace(/^.*\/([^\/]*)$/,'$1');}
function getRecoveredIframe(slotName){var node=doc.querySelector('#'+slotName+' > .provider-container:not(.hidden) > div'),fallbackId=node&&win._sp_.getElementId(node.id),elementById=fallbackId&&doc.getElementById(fallbackId);if(elementById){return elementById.querySelector('div[id*="_container_"] iframe');}}
function getIframe(slotName){var cssSelector='#'+slotName+' > .provider-container:not(.hidden) div[id*="_container_"] > iframe',iframe=doc.querySelector(cssSelector);if(!iframe&&recoveryHelper&&recoveryHelper.isRecoveryEnabled()&&recoveryHelper.isBlocking()){iframe=getRecoveredIframe(slotName);}
log(['getIframe',slotName,iframe&&iframe.id],log.levels.debug,logGroup);return iframe;}
return{create:create,getIframe:getIframe,getShortSlotName:getShortSlotName};});;define('ext.wikia.adEngine.utils.adLogicZoneParams',['ext.wikia.adEngine.adContext','wikia.log','wikia.location'],function(adContext,log,loc){'use strict';var calculated=false,context={},hostname=loc.hostname,logGroup='ext.wikia.adEngine.utils.adLogicZoneParams',maxNumberOfCategories=3,site,zone1,zone2;function updateContext(){context=adContext.getContext();calculated=false;}
function getDomain(){var lhost,pieces,sld='',np;lhost=hostname.toLowerCase();pieces=lhost.split('.');np=pieces.length;if(pieces[np-2]==='co'){sld=pieces[np-3]+'.'+pieces[np-2]+'.'+pieces[np-1];}else{sld=pieces[np-2]+'.'+pieces[np-1];}
return sld.replace(/\./g,'');}
function getHostnamePrefix(){var lhost=hostname.toLowerCase(),pieces=lhost.split('.');if(pieces.length){return pieces[0];}}
function getVerticalName(targeting){if(getHostnamePrefix()==='showcase'||context.opts.showcase===true){return'showcase';}
return targeting.mappedVerticalName;}
function getRawDbName(){return'_'+(context.targeting.wikiDbName||'wikia').replace('/[^0-9A-Z_a-z]/','_');}
function calculateParams(){log('calculateParams','info',logGroup);var mappedVertical=getVerticalName(context.targeting);if(context.targeting.pageIsHub){site='hub';zone1='_'+mappedVertical+'_hub';zone2='hub';}else{site=mappedVertical;zone1=getRawDbName();zone2=context.targeting.pageType||'article';}
calculated=true;log(['calculateParams',site,zone1,zone2],'info',logGroup);}
function getSite(){if(!calculated){calculateParams();}
return site;}
function getName(){if(!calculated){calculateParams();}
return zone1;}
function getPageType(){if(!calculated){calculateParams();}
return zone2;}
function getVertical(){return context.targeting.wikiVertical;}
function getPageCategories(){var categories=context.targeting.pageCategories,outCategories;if(categories instanceof Array&&categories.length>0){outCategories=categories.slice(0,maxNumberOfCategories);return outCategories.join('|').toLowerCase().replace(/ /g,'_').split('|');}}
function getLanguage(){return context.targeting.wikiLanguage||'unknown';}
function getWikiCategories(){return context.targeting.newWikiCategories;}
updateContext();adContext.addCallback(updateContext);return{getDomain:getDomain,getHostnamePrefix:getHostnamePrefix,getSite:getSite,getName:getName,getPageType:getPageType,getVertical:getVertical,getPageCategories:getPageCategories,getWikiCategories:getWikiCategories,getLanguage:getLanguage,getRawDbName:getRawDbName};});;define('ext.wikia.aRecoveryEngine.recovery.helper',['ext.wikia.adEngine.adContext','wikia.document','wikia.instantGlobals','wikia.lazyqueue','wikia.log','wikia.window'],function(adContext,doc,instantGlobals,lazyQueue,log,win){'use strict';var logGroup='ext.wikia.aRecoveryEngine.recovery.helper',context=adContext.getContext(),customLogEndpoint='/wikia.php?controller=ARecoveryEngineApi&method=getLogInfo&kind=',cb=function(callback){callback();},onBlockingEventsQueue=lazyQueue.makeQueue([],cb),onNotBlockingEventsQueue=lazyQueue.makeQueue([],cb);function initEventQueues(){doc.addEventListener('sp.not_blocking',onNotBlockingEventsQueue.start);doc.addEventListener('sp.blocking',onBlockingEventsQueue.start);}
function addOnBlockingCallback(callback){onBlockingEventsQueue.push(callback);}
function addOnNotBlockingCallback(callback){onNotBlockingEventsQueue.push(callback);}
function isRecoveryEnabled(){log(['isRecoveryEnabled',!!context.opts.sourcePointRecovery],'debug',logGroup);return!!context.opts.sourcePointRecovery;}
function isBlocking(){log(['isBlocking',!!(win.ads&&win.ads.runtime.sp&&win.ads.runtime.sp.blocking)],'debug',logGroup);return!!(win.ads&&win.ads.runtime.sp&&win.ads.runtime.sp.blocking);}
function isRecoverable(slotName,recoverableSlots){return isRecoveryEnabled()&&recoverableSlots.indexOf(slotName)!==-1;}
function track(type){if(win._sp_&&!win._sp_.trackingSent){if(Wikia&&Wikia.Tracker){Wikia.Tracker.track({eventName:'ads.recovery',ga_category:'ads-recovery-blocked',ga_action:Wikia.Tracker.ACTIONS.IMPRESSION,ga_label:type,trackingMethod:'analytics'});}
if(instantGlobals.wgARecoveryEngineCustomLog){try{var xmlHttp=new XMLHttpRequest();xmlHttp.open('GET',customLogEndpoint+type,true);xmlHttp.send();}catch(e){log(['track',e],'error',logGroup);}}
win._sp_.trackingSent=true;}}
function verifyContent(){var wikiaArticle=doc.getElementById('WikiaArticle'),display=wikiaArticle.currentStyle?wikiaArticle.currentStyle.display:getComputedStyle(wikiaArticle,null).display;if(display==='none'){track('css-display-none');}}
function getSafeUri(url){return win._sp_.getSafeUri(url);}
return{addOnBlockingCallback:addOnBlockingCallback,addOnNotBlockingCallback:addOnNotBlockingCallback,getSafeUri:getSafeUri,initEventQueues:initEventQueues,isBlocking:isBlocking,isRecoverable:isRecoverable,isRecoveryEnabled:isRecoveryEnabled,track:track,verifyContent:verifyContent};});;window.Krux||((Krux=function(){Krux.q.push(arguments);}).q=[]);define('wikia.krux',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adTracker','wikia.document','wikia.tracker','wikia.window'],function(adContext,adTracker,doc,wikiaTracker,win){'use strict';var maxNumberOfKruxSegments=50,kruxScriptId='krux-control-tag',kruxLoaded=false,segmentsCountTracked=false;function exportPageParams(adLogicPageParams){var params,value;if(Object.keys){params=adLogicPageParams.getPageLevelParams();Object.keys(params).forEach(function(key){value=params[key];if(value){win['kruxDartParam_'+key]=value.toString();}});}}
function addConfigScript(confid){var k,m,src,s;k=document.createElement('script');k.type='text/javascript';k.id=kruxScriptId;k.async=true;src=(m=location.href.match(/\bkxsrc=([^&]+)\b/))&&decodeURIComponent(m[1]);k.src=src||(location.protocol==='https:'?'https:':'http:')+'//cdn.krxd.net/controltag?confid='+confid;s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(k,s);}
function load(confid){require(['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adLogicPageParams'],function(adContext,adLogicPageParams){var script;if(adContext.getContext().targeting.enableKruxTargeting){exportPageParams(adLogicPageParams);script=doc.getElementById(kruxScriptId);if(script){script.parentNode.removeChild(script);}
addConfigScript(confid);kruxLoaded=true;adTracker.track('krux/load');wikiaTracker.track({category:'ads-trackers',action:'krux',label:'load',value:0,trackingMethod:'analytics'});}});}
function getParams(n){var k='kx'+n;if(win.localStorage){return win.localStorage[k]||'';}else{return'';}}
function trackNumberOfSegments(numberOfSegments){if(segmentsCountTracked){return;}
var label=numberOfSegments+'';while(label.length<4){label='0'+label;}
adTracker.track('krux/segments_count',{},numberOfSegments,label);segmentsCountTracked=true;}
function getSegments(){var segments=getParams('segs'),segsArray;if(segments===''){trackNumberOfSegments(0);return[];}
segsArray=segments.split(',');trackNumberOfSegments(segsArray.length);return segsArray.slice(0,maxNumberOfKruxSegments);}
function getUser(){return getParams('user');}
function sendEvent(eventId,data){if(!kruxLoaded){return false;}
Krux('admEvent',eventId,data||{});return true;}
adContext.addCallback(function(){segmentsCountTracked=false;});return{load:load,getSegments:getSegments,getUser:getUser,sendEvent:sendEvent};});;


define('ext.wikia.adEngine.lookup.amazonMatch',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.context.slotsContext','ext.wikia.adEngine.lookup.lookupFactory','wikia.document','wikia.log','wikia.window'],function(adContext,slotsContext,factory,doc,log,win){'use strict';var logGroup='ext.wikia.adEngine.lookup.amazonMatch',config={oasis:{HOME_TOP_LEADERBOARD:['7x9','9x2'],HOME_TOP_RIGHT_BOXAD:['3x2','3x6'],HUB_TOP_LEADERBOARD:['7x9','9x2'],HUB_TOP_RIGHT_BOXAD:['3x2','3x6'],INCONTENT_BOXAD_1:['3x2','1x6','3x6'],LEFT_SKYSCRAPER_2:['1x6','3x2','3x6'],LEFT_SKYSCRAPER_3:['1x6','3x2','3x6'],TOP_LEADERBOARD:['7x9','9x2'],TOP_RIGHT_BOXAD:['3x2','3x6'],INCONTENT_LEADERBOARD:['7x9','3x2']},mercury:{MOBILE_IN_CONTENT:['3x2'],MOBILE_PREFOOTER:['3x2'],MOBILE_TOP_LEADERBOARD:['3x5']}},rendered=false,paramPattern=/([0-9]x[0-9])/,amazonId='3115',priceMap={},slots=[];function call(skin,onResponse){var amznMatch=doc.createElement('script'),context=adContext.getContext(),node=doc.getElementsByTagName('script')[0];slots=slotsContext.filterSlotMap(config[skin]);if(context.opts.overridePrefootersSizes){slots.PREFOOTER_LEFT_BOXAD=['3x2','7x9'];}
amznMatch.type='text/javascript';amznMatch.src='http://c.amazon-adsystem.com/aax2/amzn_ads.js';amznMatch.addEventListener('load',function(){var renderAd=win.amznads.renderAd;if(!win.amznads.getAdsCallback||!renderAd){return;}
win.amznads.getAdsCallback(amazonId,onResponse);win.amznads.renderAd=function(doc,adId){renderAd(doc,adId);rendered=true;};});node.parentNode.insertBefore(amznMatch,node);}
function calculatePrices(){var size,tokens,m;tokens=win.amznads.getTokens();log(['calculatePrices',tokens],'debug',logGroup);tokens.forEach(function(param){m=param.match(paramPattern);if(m){size=m[1];if(!priceMap[size]){priceMap[size]=[];}
priceMap[size].push(param);}});}
function encodeParamsForTracking(params){if(!params.amznslots){return;}
return params.amznslots.join(';');}
function getSlotParams(slotName){var params=[];if(rendered){log(['getSlotParams','No params since ad has been already displayed',slotName],'debug',logGroup);return{};}
slots[slotName].forEach(function(size){if(priceMap[size]){priceMap[size].forEach(function(price){params.push(price);});}});return params.length>0?{amznslots:params.sort()}:{};}
function getPrices(){return priceMap;}
function isSlotSupported(slotName){return slots[slotName];}
return factory.create({logGroup:logGroup,name:'amazon',call:call,calculatePrices:calculatePrices,getPrices:getPrices,isSlotSupported:isSlotSupported,encodeParamsForTracking:encodeParamsForTracking,getSlotParams:getSlotParams});});;


define('ext.wikia.adEngine.lookup.prebid',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.lookup.prebid.adaptersPerformanceTracker','ext.wikia.adEngine.lookup.prebid.adaptersPricesTracker','ext.wikia.adEngine.lookup.prebid.adaptersRegistry','ext.wikia.adEngine.lookup.prebid.adapters.wikia','ext.wikia.adEngine.lookup.prebid.prebidHelper','ext.wikia.adEngine.lookup.lookupFactory','wikia.document','wikia.window'],function(adContext,performanceTracker,pricesTracker,adaptersRegistry,wikiaAdapter,helper,factory,doc,win){'use strict';var adUnits=[],biddersPerformanceMap={},autoPriceGranularity='auto',prebidLoaded=false;function call(skin,onResponse){var prebid,node;if(!prebidLoaded){prebid=doc.createElement('script');node=doc.getElementsByTagName('script')[0];if(wikiaAdapter.isEnabled()){adaptersRegistry.push(wikiaAdapter);win.pbjs.que.push(function(){win.pbjs.registerBidAdapter(wikiaAdapter.create,'wikia');});}
prebid.async=true;prebid.type='text/javascript';prebid.src=adContext.getContext().opts.prebidBidderUrl||'//acdn.adnxs.com/prebid/prebid.js';node.parentNode.insertBefore(prebid,node);}
biddersPerformanceMap=performanceTracker.setupPerformanceMap(skin);adUnits=helper.setupAdUnits(skin);if(adUnits.length>0){if(!prebidLoaded){win.pbjs.que.push(function(){win.pbjs.setPriceGranularity(autoPriceGranularity);win.pbjs.addAdUnits(adUnits);});}
win.pbjs.que.push(function(){win.pbjs._bidsReceived=[];win.pbjs._winningBids=[];win.pbjs.requestBids({bidsBackHandler:onResponse});});}
prebidLoaded=true;}
function calculatePrices(){biddersPerformanceMap=performanceTracker.updatePerformanceMap(biddersPerformanceMap);}
function trackAdaptersOnLookupEnd(){var adapters=adaptersRegistry.getAdapters();biddersPerformanceMap=performanceTracker.updatePerformanceMap(biddersPerformanceMap);adapters.forEach(function(adapter){performanceTracker.trackBidderOnLookupEnd(adapter,biddersPerformanceMap);});}
function trackAdaptersSlotState(providerName,slotName){var adapters=adaptersRegistry.getAdapters();biddersPerformanceMap=performanceTracker.updatePerformanceMap(biddersPerformanceMap);adapters.forEach(function(adapter){performanceTracker.trackBidderSlotState(adapter,slotName,providerName,biddersPerformanceMap);});}
function isSlotSupported(slotName){return adUnits.some(function(adUnit){return adUnit.code===slotName;});}
function getSlotParams(slotName){var params;if(win.pbjs&&typeof win.pbjs.getAdserverTargetingForAdUnitCode==='function'){params=win.pbjs.getAdserverTargetingForAdUnitCode(slotName)||{};}
return params||{};}
function getBestSlotPrice(slotName){return pricesTracker.getSlotBestPrice(slotName);}
return factory.create({logGroup:'ext.wikia.adEngine.lookup.prebid',name:'prebid',call:call,calculatePrices:calculatePrices,isSlotSupported:isSlotSupported,getSlotParams:getSlotParams,getBestSlotPrice:getBestSlotPrice,trackAdaptersOnLookupEnd:trackAdaptersOnLookupEnd,trackAdaptersSlotState:trackAdaptersSlotState});});;define('ext.wikia.adEngine.lookup.prebid.prebidHelper',['ext.wikia.adEngine.lookup.prebid.adaptersRegistry'],function(adaptersRegistry){'use strict';var adUnits=[];function getAdapterAdUnits(adapter,skin){var adapterAdUnits=[],slots=adapter.getSlots(skin);Object.keys(slots).forEach(function(slotName){var adUnit=adapter.prepareAdUnit(slotName,slots[slotName],skin);if(adUnit){adapterAdUnits.push(adUnit);}});return adapterAdUnits;}
function addAdUnits(adapterAdUnits){adapterAdUnits.forEach(function(adUnit){adUnits.push(adUnit);});}
function setupAdUnits(skin){var adapters=adaptersRegistry.getAdapters();adapters.forEach(function(adapter){if(adapter&&adapter.isEnabled()){addAdUnits(getAdapterAdUnits(adapter,skin));}});return adUnits;}
return{setupAdUnits:setupAdUnits};});;define('ext.wikia.adEngine.lookup.prebid.adaptersPerformanceTracker',['ext.wikia.adEngine.adTracker','ext.wikia.adEngine.lookup.prebid.adaptersRegistry','ext.wikia.adEngine.utils.timeBuckets','ext.wikia.adEngine.wrappers.prebid'],function(adTracker,adaptersRegistry,timeBuckets,prebid){'use strict';var buckets=[0.0,0.5,1.0,1.5,2.0,2.5,3.0],emptyResponseMsg='EMPTY_RESPONSE',notRespondedMsg='NO_RESPONSE',responseErrorCode=2;function setupPerformanceMap(skin){var biddersPerformanceMap={},adapters=adaptersRegistry.getAdapters();adapters.forEach(function(adapter){var slots=adapter.getSlots(skin),adapterName=adapter.getName();if(adapter.isEnabled()){biddersPerformanceMap[adapterName]={};Object.keys(slots).forEach(function(slotName){biddersPerformanceMap[adapterName][slotName]=notRespondedMsg;});}});return biddersPerformanceMap;}
function updatePerformanceMap(performanceMap){var allBids;if(typeof prebid.get().getBidResponses==='function'){allBids=prebid.get().getBidResponses();Object.keys(allBids).forEach(function(slotName){var slotBids=allBids[slotName].bids;slotBids.forEach(function(bid){performanceMap[bid.bidder][slotName]=getParamsFromBidForTracking(bid);});});}
return performanceMap;}
function trackBidderSlotState(adapter,slotName,providerName,performanceMap){var bidderName=adapter.getName(),category;if(!adapter.isEnabled()){return;}
if(!performanceMap[bidderName][slotName]){return;}
if(performanceMap[bidderName][slotName]!==notRespondedMsg){category=bidderName+'/lookup_success/'+providerName;adTracker.track(category,slotName,0,performanceMap[bidderName][slotName]);}else{category=bidderName+'/lookup_error/'+providerName;adTracker.track(category,slotName,0,'nodata');}}
function trackBidderOnLookupEnd(adapter,performanceMap){var bidderName=adapter.getName();if(adapter.isEnabled()){adTracker.track(bidderName+'/lookup_end',performanceMap[bidderName],0,'nodata');}}
function getParamsFromBidForTracking(bid){var bucket=timeBuckets.getTimeBucket(buckets,bid.timeToRespond/1000);if(bid.getStatusCode()===responseErrorCode){return[emptyResponseMsg,bucket].join(';');}
return[bid.getSize(),bid.pbMg,bucket].join(';');}
return{setupPerformanceMap:setupPerformanceMap,trackBidderOnLookupEnd:trackBidderOnLookupEnd,trackBidderSlotState:trackBidderSlotState,updatePerformanceMap:updatePerformanceMap}});;define('ext.wikia.adEngine.lookup.prebid.adaptersPricesTracker',['ext.wikia.adEngine.lookup.prebid.adaptersRegistry','ext.wikia.adEngine.wrappers.prebid'],function(adaptersRegistry,prebid){'use strict';function getSlotBestPrice(slotName){var prebidCmd=prebid.get(),slotBids=prebidCmd.getBidResponsesForAdUnitCode(slotName).bids||[],bestPrices={};adaptersRegistry.getAdapters().forEach(function(adapter){bestPrices[adapter.getName()]=undefined;});slotBids.forEach(function(bid){bestPrices[bid.bidderCode]=Math.max(bestPrices[bid.bidderCode],bid.pbMg)||0;if(typeof bestPrices[bid.bidderCode]!=='undefined'){bestPrices[bid.bidderCode]=(bestPrices[bid.bidderCode]/100).toFixed(2).toString();}});return bestPrices;}
return{getSlotBestPrice:getSlotBestPrice}});;define('ext.wikia.adEngine.lookup.prebid.adaptersRegistry',['ext.wikia.adEngine.lookup.prebid.adapters.appnexus','ext.wikia.adEngine.lookup.prebid.adapters.indexExchange'],function(appnexus,index){'use strict';var adapters=[appnexus,index];function getAdapters(){return adapters;}
function push(adapter){adapters.push(adapter);}
return{getAdapters:getAdapters,push:push}});;define('ext.wikia.adEngine.lookup.prebid.adapters.appnexus',['ext.wikia.adEngine.context.slotsContext','ext.wikia.adEngine.lookup.prebid.adapters.appnexusPlacements','wikia.geo','wikia.instantGlobals'],function(slotsContext,appnexusPlacements,geo,instantGlobals){'use strict';var bidderName='appnexus',slots={oasis:{TOP_LEADERBOARD:{sizes:[[728,90],[970,250]],position:'atf'},HOME_TOP_LEADERBOARD:{sizes:[[728,90],[970,250]],position:'atf'},TOP_RIGHT_BOXAD:{sizes:[[300,250],[300,600]],position:'atf'},HOME_TOP_RIGHT_BOXAD:{sizes:[[300,250],[300,600]],position:'atf'},PREFOOTER_LEFT_BOXAD:{sizes:[[300,250]],position:'btf'},PREFOOTER_MIDDLE_BOXAD:{sizes:[[300,250]],position:'btf'},PREFOOTER_RIGHT_BOXAD:{sizes:[[300,250]],position:'btf'},LEFT_SKYSCRAPER_2:{sizes:[[160,600],[300,600],[300,250]],position:'btf'},LEFT_SKYSCRAPER_3:{sizes:[[160,600],[300,600],[300,250]],position:'btf'},INCONTENT_BOXAD_1:{sizes:[[160,600],[300,600],[300,250]],position:'hivi'}},mercury:{MOBILE_TOP_LEADERBOARD:{sizes:[[320,50]]},MOBILE_IN_CONTENT:{sizes:[[300,250],[320,480]]},MOBILE_PREFOOTER:{sizes:[[300,250],[320,50]]}}};function isEnabled(){return geo.isProperGeo(instantGlobals.wgAdDriverAppNexusBidderCountries);}
function prepareAdUnit(slotName,config,skin){var placementId=appnexusPlacements.getPlacement(skin,config.position);if(!placementId){return;}
return{code:slotName,sizes:config.sizes,bids:[{bidder:bidderName,params:{placementId:placementId}}]};}
function getSlots(skin){return slotsContext.filterSlotMap(slots[skin]);}
function getName(){return bidderName;}
return{isEnabled:isEnabled,getName:getName,getSlots:getSlots,prepareAdUnit:prepareAdUnit};});;define('ext.wikia.adEngine.lookup.prebid.adapters.appnexusPlacements',['ext.wikia.adEngine.adContext','wikia.instantGlobals','wikia.log'],function(adContext,instantGlobals,log){'use strict';var logGroup='ext.wikia.adEngine.lookup.prebid.adapters.appnexusPlacements',placementsMap=instantGlobals.wgAdDriverAppNexusBidderPlacementsConfig;function getPlacement(skin,position){var vertical=adContext.getContext().targeting.mappedVerticalName;if(placementsMap&&placementsMap[skin]&&placementsMap[skin][vertical]){if(position&&placementsMap[skin][vertical][position]){return placementsMap[skin][vertical][position];}
if(!position||position==='atf'){return placementsMap[skin][vertical];}}
log(['getPlacement',skin,vertical,position,'wgAdDriverAppNexusBidderPlacementsConfig variable not set or not configured correctly'],'error',logGroup);}
return{getPlacement:getPlacement};});;define('ext.wikia.adEngine.lookup.prebid.adapters.indexExchange',['ext.wikia.adEngine.context.slotsContext','wikia.geo','wikia.instantGlobals'],function(slotsContext,geo,instantGlobals){'use strict';var bidderName='indexExchange',slots={oasis:{TOP_LEADERBOARD:{sizes:[[728,90],[970,250]],id:'1',siteID:183423},HOME_TOP_LEADERBOARD:{sizes:[[728,90],[970,250]],id:'1',siteID:183423},TOP_RIGHT_BOXAD:{sizes:[[300,250],[300,600]],id:'2',siteID:183567},HOME_TOP_RIGHT_BOXAD:{sizes:[[300,250],[300,600]],id:'2',siteID:183567},PREFOOTER_LEFT_BOXAD:{sizes:[[300,250]],id:'4',siteID:185052},PREFOOTER_MIDDLE_BOXAD:{sizes:[[300,250]],id:'5',siteID:185054},PREFOOTER_RIGHT_BOXAD:{sizes:[[300,250]],id:'6',siteID:185053},LEFT_SKYSCRAPER_2:{sizes:[[160,600],[300,600],[300,250]],id:'7',siteID:185050},LEFT_SKYSCRAPER_3:{sizes:[[160,600],[300,600],[300,250]],id:'8',siteID:185051},INCONTENT_BOXAD_1:{sizes:[[160,600],[300,600],[300,250]],id:'9',siteID:185049}},mercury:{MOBILE_TOP_LEADERBOARD:{sizes:[[320,50]],id:'3',siteID:183568},MOBILE_IN_CONTENT:{sizes:[[300,250],[320,480]],id:'10',siteID:185055},MOBILE_PREFOOTER:{sizes:[[300,250],[320,50]],id:'11',siteID:185056}}};function isEnabled(){return geo.isProperGeo(instantGlobals.wgAdDriverIndexExchangeBidderCountries);}
function getSlots(skin){return slotsContext.filterSlotMap(slots[skin]);}
function prepareAdUnit(slotName,config){return{code:slotName,sizes:config.sizes,bids:[{bidder:bidderName,params:{id:config.id,siteID:config.siteID}}]};}
function getName(){return bidderName;}
return{isEnabled:isEnabled,getName:getName,getSlots:getSlots,prepareAdUnit:prepareAdUnit};});;define('ext.wikia.adEngine.lookup.prebid.adapters.wikia',['ext.wikia.adEngine.wrappers.prebid','wikia.document','wikia.querystring'],function(prebid,doc,QueryString){'use strict';var bidderName='wikia',slots={oasis:{TOP_LEADERBOARD:{sizes:[[728,90]]},TOP_RIGHT_BOXAD:{sizes:[[300,250]]}},mercury:{MOBILE_TOP_LEADERBOARD:{sizes:[[320,50]]}}},qs=new QueryString();function getPrice(){var price=qs.getVal('wikia_adapter',0);return parseInt(price,10)/100;}
function isEnabled(){return getPrice()!==0;}
function prepareAdUnit(slotName,config){return{code:slotName,sizes:config.sizes,bids:[{bidder:bidderName}]};}
function getSlots(skin){return slots[skin];}
function getName(){return bidderName;}
function getCreative(price,size){var creative=doc.createElement('div'),details=doc.createElement('small'),title=doc.createElement('p');creative.style.background='#00b7e0';creative.style.color='#fff';creative.style.fontFamily='sans-serif';creative.style.height='100%';creative.style.textAlign='center';creative.style.width='100%';title.innerText='Wikia Creative';title.style.fontWeight='bold';title.style.margin='0';title.style.paddingTop='10px';details.innerText='price: '+price+', size: '+size.join('x');creative.appendChild(title);creative.appendChild(details);return creative.outerHTML;}
function addBids(bidderRequest){bidderRequest.bids.forEach(function(bid){var bidResponse=prebid.get().createBid(1),price=getPrice();bidResponse.bidderCode=bidderRequest.bidderCode;bidResponse.cpm=price;bidResponse.ad=getCreative(price,bid.sizes[0]);bidResponse.width=bid.sizes[0][0];bidResponse.height=bid.sizes[0][1];prebid.get().addBidResponse(bid.placementCode,bidResponse);});}
function create(){return{callBids:function(bidderRequest){prebid.push(function(){addBids(bidderRequest);});}};}
return{create:create,isEnabled:isEnabled,getName:getName,getSlots:getSlots,prepareAdUnit:prepareAdUnit};});;define('ext.wikia.adEngine.wrappers.prebid',['wikia.window'],function(win){'use strict';win.pbjs=win.pbjs||{};win.pbjs.que=win.pbjs.que||[];return{get:function(){return win.pbjs;},push:function(callback){win.pbjs.que.push(callback);}};});;


define('ext.wikia.adEngine.lookup.openx.openXBidderHelper',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.context.slotsContext','ext.wikia.adEngine.utils.adLogicZoneParams','wikia.log','wikia.window'],function(adContext,slotsContext,adLogicZoneParams,log,win){'use strict';var slots={},openXTimeoutChanged=false,logGroup='ext.wikia.adEngine.lookup.openx.openXBidderHelper',config={oasis:{TOP_LEADERBOARD:{sizes:['728x90','970x250']},HOME_TOP_LEADERBOARD:{sizes:['728x90','970x250']},TOP_RIGHT_BOXAD:{sizes:['300x250','300x600']},HOME_TOP_RIGHT_BOXAD:{sizes:['300x250','300x600']},LEFT_SKYSCRAPER_2:{sizes:['160x600','300x600']},LEFT_SKYSCRAPER_3:{sizes:['160x600','300x600']},INCONTENT_BOXAD_1:{sizes:['300x250','300x600','160x600']},PREFOOTER_LEFT_BOXAD:{sizes:['300x250']},PREFOOTER_MIDDLE_BOXAD:{sizes:['300x250']},PREFOOTER_RIGHT_BOXAD:{sizes:['300x250']}},mercury:{MOBILE_IN_CONTENT:{sizes:['300x250','320x50']},MOBILE_PREFOOTER:{sizes:['300x250','320x50']},MOBILE_TOP_LEADERBOARD:{sizes:['300x250','320x50']}}};function getSlots(){return slots;}
function addSlot(slotName,properties){slots[slotName]=properties;}
function removeSlot(slotName){delete slots[slotName];}
function isOpenXRemnantEnabledInGeo(){var context=adContext.getContext();return context.opts.openXRemnantEnabled;}
function setupSlots(skin){slots=slotsContext.filterSlotMap(config[skin]);}
function isSlotSupported(slotName){var isSupported=!!slots[slotName];log(['isSupported',slotName,isSupported],'debug',logGroup);return isSupported;}
function changeTimeout(){if(!openXTimeoutChanged){if(win.OXHBConfig){win.OXHBConfig.DFP_mapping.timeout=0;log(['changeTimeout'],'debug',logGroup);}
openXTimeoutChanged=true;}}
function getPagePath(){return['/5441','wka.'+adLogicZoneParams.getSite(),adLogicZoneParams.getName(),'',adLogicZoneParams.getPageType()].join('/');}
function getSlothPath(slotName,src){src=src||'remnant';return'wikia_gpt'+getPagePath()+'/'+src+'/'+slotName;}
function addOpenXSlot(slotName){if(isOpenXRemnantEnabledInGeo()&&isSlotSupported(slotName)&&win.OX){log(['addOpenXSlot',slotName],'debug',logGroup);changeTimeout();win.OX.dfp_bidder.addSlots([[getPagePath(),slots[slotName].sizes,getSlothPath(slotName)]]);}}
return{addOpenXSlot:addOpenXSlot,getSlots:getSlots,addSlot:addSlot,removeSlot:removeSlot,isSlotSupported:isSlotSupported,setupSlots:setupSlots,getPagePath:getPagePath,getSlotPath:getSlothPath};});;define('ext.wikia.adEngine.lookup.openXBidder',['ext.wikia.adEngine.lookup.lookupFactory','ext.wikia.adEngine.slot.adSlot','ext.wikia.adEngine.lookup.openx.openXBidderHelper','wikia.document','wikia.log','wikia.window'],function(factory,adSlot,openXHelper,doc,log,win){'use strict';var logGroup='ext.wikia.adEngine.lookup.openXBidder',priceTimeout='t',priceMap={};function getAds(){var ads=[],sizes,slotName,slots=openXHelper.getSlots(),pagePath=openXHelper.getPagePath();for(slotName in slots){if(slots.hasOwnProperty(slotName)){sizes=slots[slotName].sizes;ads.push([pagePath,sizes,openXHelper.getSlotPath(slotName,'gpt')]);}}
return ads;}
function getSlotParams(slotName){var dfpParams={},dfpKey,price,size;if(!priceMap[slotName]){log(['getSlotParams','No response for the slot',slotName],'debug',logGroup);return{};}
price=priceMap[slotName].price;size=priceMap[slotName].size;if(!price){log(['getSlotParams','No price for the slot',slotName],'debug',logGroup);return{};}
dfpKey='ox'+size;dfpParams[dfpKey]=price;log(['getSlotParams',dfpKey,price],'debug',logGroup);return dfpParams;}
function encodeParamsForTracking(params){var key,encoded=[];for(key in params){if(params.hasOwnProperty(key)){encoded.push(key+'='+params[key]);}}
return encoded.join(';');}
function calculatePrices(){var prices=win.OX.dfp_bidder.getPriceMap(),slotName,shortSlotName;for(slotName in prices){if(prices.hasOwnProperty(slotName)&&prices[slotName].price!==priceTimeout){shortSlotName=adSlot.getShortSlotName(slotName);priceMap[shortSlotName]=prices[slotName];}}}
function call(skin,onResponse){var openx=doc.createElement('script'),node=doc.getElementsByTagName('script')[0];openXHelper.setupSlots(skin);win.OX_dfp_ads=getAds();win.OX_dfp_options={callback:onResponse};openx.async=true;openx.type='text/javascript';openx.src='//ox-d.wikia.servedbyopenx.com/w/1.0/jstag?nc=5441-Wikia';node.parentNode.insertBefore(openx,node);}
function getPrices(){var prices={};for(var slotName in priceMap){if(priceMap.hasOwnProperty(slotName)){prices[slotName]=priceMap[slotName].price;}}
return prices;}
return factory.create({logGroup:logGroup,name:'ox_bidder',call:call,calculatePrices:calculatePrices,getPrices:getPrices,encodeParamsForTracking:encodeParamsForTracking,getSlotParams:getSlotParams,isSlotSupported:openXHelper.isSlotSupported});});;


define('ext.wikia.adEngine.lookup.rubicon.rubiconTargeting',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.utils.adLogicZoneParams'],function(adContext,adLogicZoneParams){'use strict';var context;function getContextTargeting(){if(!context){context=adContext.getContext();}
return context.targeting;}
function getTargeting(slotName,skin,passback){var provider=skin==='oasis'?'gpt':'mobile',s1=getContextTargeting().wikiIsTop1000?adLogicZoneParams.getName():'not a top1k wiki';return{pos:slotName,src:provider,s0:adLogicZoneParams.getSite(),s1:s1,s2:adLogicZoneParams.getPageType(),lang:adLogicZoneParams.getLanguage(),passback:passback};}
return{getTargeting:getTargeting};});;define('ext.wikia.adEngine.lookup.rubicon.rubiconTier',['ext.wikia.adEngine.utils.math'],function(math){'use strict';var cpmBuckets=[{maxValue:4,bucket:1},{maxValue:99,bucket:5},{maxValue:499,bucket:10},{maxValue:1999,bucket:50}];function create(sizeId,cpm){var index=0,tier=2000;while(cpmBuckets[index]&&cpm>cpmBuckets[index].maxValue){index+=1;}
if(cpmBuckets[index]){tier=math.getBucket(cpm,cpmBuckets[index].bucket);}
tier=Math.max(0,parseInt(tier,10));return sizeId+'_tier'+math.leftPad(tier,4);}
function parsePrice(tier){var matches=/^\d+_tier(\d+)/g.exec(tier);if(matches&&matches[1]){return parseInt(matches[1],10);}
return 0;}
return{create:create,parsePrice:parsePrice};});;define('ext.wikia.adEngine.lookup.rubicon.rubiconFastlane',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.context.slotsContext','ext.wikia.adEngine.lookup.lookupFactory','ext.wikia.adEngine.lookup.rubicon.rubiconTargeting','ext.wikia.adEngine.lookup.rubicon.rubiconTier','wikia.document','wikia.log','wikia.window'],function(adContext,slotsContext,factory,rubiconTargeting,rubiconTier,doc,log,win){'use strict';var bestPrices={},config={oasis:{TOP_LEADERBOARD:{sizes:[[728,90],[970,250]],targeting:{loc:'top'}},HOME_TOP_LEADERBOARD:{sizes:[[728,90],[970,250]],targeting:{loc:'top'}},TOP_RIGHT_BOXAD:{sizes:[[300,250],[300,600],[300,1050]],targeting:{loc:'top'}},HOME_TOP_RIGHT_BOXAD:{sizes:[[300,250],[300,600],[300,1050]],targeting:{loc:'top'}},LEFT_SKYSCRAPER_2:{sizes:[[120,600],[160,600],[300,250],[300,600],[300,1050]],targeting:{loc:'middle'}},LEFT_SKYSCRAPER_3:{sizes:[[120,600],[160,600],[300,250],[300,600]],targeting:{loc:'footer'}},INCONTENT_BOXAD_1:{sizes:[[120,600],[160,600],[300,250],[300,600]],targeting:{loc:'hivi'}},INVISIBLE_HIGH_IMPACT_2:{sizes:[[728,90],[970,250],[480,320],[300,250],[300,600],[320,480]],targeting:{loc:'hivi'}},PREFOOTER_LEFT_BOXAD:{sizes:[[300,250],[336,280]],targeting:{loc:'footer'}},PREFOOTER_MIDDLE_BOXAD:{sizes:[[300,250]],targeting:{loc:'footer'}},PREFOOTER_RIGHT_BOXAD:{sizes:[[300,250]],targeting:{loc:'footer'}}},mercury:{MOBILE_IN_CONTENT:{sizes:[[300,50],[300,250],[320,50],[320,480]]},MOBILE_PREFOOTER:{sizes:[[300,50],[300,250],[320,50]]},MOBILE_TOP_LEADERBOARD:{sizes:[[300,50],[300,250],[320,50],[320,480]]}}},context,logGroup='ext.wikia.adEngine.lookup.rubicon.rubiconFastlane',priceMap={},response,rubiconSlots=[],rubiconElementKey='rpfl_elemid',rubiconTierKey='rpfl_7450',rubiconLibraryUrl='//ads.rubiconproject.com/header/7450.js',rubiconLoaded=false,sizeMap={'468x60':1,'728x90':2,'120x600':8,'160x600':9,'300x600':10,'300x250':15,'320x50':43,'300x50':44,'336x280':49,'300x1050':54,'970x250':57,'320x480':67,'480x320':101},slots;function compareTiers(a,b){var aMatches=/^(\d+)/.exec(a),bMatches=/^(\d+)/.exec(b);if(aMatches&&bMatches){return parseInt(aMatches[1],10)>parseInt(bMatches[1],10)?1:-1;}
return 0;}
function addSlotPrice(slotName,rubiconTargeting){rubiconTargeting.forEach(function(params){if(params.key===rubiconTierKey){priceMap[slotName]=params.values.sort(compareTiers).join(',');saveBestPrice(slotName,params.values);}});}
function setTargeting(slotName,slotTargeting,rubiconSlot,skin){var targeting=rubiconTargeting.getTargeting(slotName,skin,'fastlane');if(slotTargeting){Object.keys(slotTargeting).forEach(function(key){rubiconSlot.setFPI(key,slotTargeting[key]);});}
Object.keys(targeting).forEach(function(key){rubiconSlot.setFPI(key,targeting[key]);});}
function defineSingleSlot(slotName,slot,skin){var position=slotName.indexOf('TOP')!==-1?'atf':'btf';log(['defineSlot',slotName,slot],'debug',logGroup);win.rubicontag.cmd.push(function(){var rubiconSlot=win.rubicontag.defineSlot(slotName,slot.sizes,slotName);if(skin==='oasis'){rubiconSlot.setPosition(position);}
setTargeting(slotName,slot.targeting,rubiconSlot,skin);rubiconSlots.push(rubiconSlot);});}
function configureSlots(skin){slots=slotsContext.filterSlotMap(config[skin]);if(context.opts.overridePrefootersSizes){slots.PREFOOTER_LEFT_BOXAD.sizes=[[300,250],[336,280],[468,60],[728,90]];}}
function defineSlots(skin,onResponse){rubiconSlots=[];Object.keys(slots).forEach(function(slotName){defineSingleSlot(slotName,slots[slotName],skin);});win.rubicontag.cmd.push(function(){win.rubicontag.run(onResponse,{slots:rubiconSlots});});}
function fillInWithMissingTiers(slotName,parameters){var allTiers;if(!response){return;}
parameters[rubiconTierKey]=parameters[rubiconTierKey]||[];allTiers=';'+parameters[rubiconTierKey].join(';');slots[slotName].sizes.forEach(function(dimensions){var size=dimensions[0]+'x'+dimensions[1],tierSize=sizeMap[size]+'_tier';if(allTiers.indexOf(';'+tierSize)===-1){parameters[rubiconTierKey].push(tierSize+'NONE');}});}
function saveBestPrice(slotName,tiers){tiers.forEach(function(tier){bestPrices[slotName]=Math.max(rubiconTier.parsePrice(tier),bestPrices[slotName]||0);});}
function getBestSlotPrice(slotName){var price;if(typeof bestPrices[slotName]!=='undefined'){price=(bestPrices[slotName]/100).toFixed(2).toString();}
return{fastlane:price};}
function getSlotParams(slotName){var targeting,parameters={};if(!win.rubicontag||typeof win.rubicontag.getSlot!=='function'||!win.rubicontag.getSlot(slotName)){return{};}
targeting=win.rubicontag.getSlot(slotName).getAdServerTargeting();targeting.forEach(function(params){if(params.key!==rubiconElementKey){parameters[params.key]=params.values;}});fillInWithMissingTiers(slotName,parameters);if(parameters[rubiconTierKey]&&typeof parameters[rubiconTierKey].sort==='function'){parameters[rubiconTierKey].sort(compareTiers);}
log(['getSlotParams',slotName,parameters],'debug',logGroup);return parameters;}
function encodeParamsForTracking(params){if(!params[rubiconTierKey]){return;}
return params[rubiconTierKey].join(';');}
function calculatePrices(){var allSlots;if(!win.rubicontag||typeof win.rubicontag.getAllSlots!=='function'){return;}
allSlots=win.rubicontag.getAllSlots();if(allSlots.length){win.rubicontag.getAllSlots().forEach(function(slot){addSlotPrice(slot.getSlotName(),slot.getAdServerTargeting());});}}
function call(skin,onResponse){response=false;if(!rubiconLoaded){var rubicon=doc.createElement('script'),node=doc.getElementsByTagName('script')[0];win.rubicontag=win.rubicontag||{};win.rubicontag.cmd=win.rubicontag.cmd||[];rubicon.async=true;rubicon.type='text/javascript';rubicon.src=rubiconLibraryUrl;node.parentNode.insertBefore(rubicon,node);context=adContext.getContext();configureSlots(skin);rubiconLoaded=true;}
defineSlots(skin,function(){response=true;priceMap={};bestPrices={};onResponse();});}
function getPrices(){return priceMap;}
function isSlotSupported(slotName){return slots[slotName];}
return factory.create({logGroup:logGroup,name:'rubicon_fastlane',call:call,calculatePrices:calculatePrices,getBestSlotPrice:getBestSlotPrice,getPrices:getPrices,isSlotSupported:isSlotSupported,encodeParamsForTracking:encodeParamsForTracking,getSlotParams:getSlotParams});});;


define('ext.wikia.adEngine.lookup.rubicon.rubiconTargeting',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.utils.adLogicZoneParams'],function(adContext,adLogicZoneParams){'use strict';var context;function getContextTargeting(){if(!context){context=adContext.getContext();}
return context.targeting;}
function getTargeting(slotName,skin,passback){var provider=skin==='oasis'?'gpt':'mobile',s1=getContextTargeting().wikiIsTop1000?adLogicZoneParams.getName():'not a top1k wiki';return{pos:slotName,src:provider,s0:adLogicZoneParams.getSite(),s1:s1,s2:adLogicZoneParams.getPageType(),lang:adLogicZoneParams.getLanguage(),passback:passback};}
return{getTargeting:getTargeting};});;define('ext.wikia.adEngine.lookup.rubicon.rubiconTier',['ext.wikia.adEngine.utils.math'],function(math){'use strict';var cpmBuckets=[{maxValue:4,bucket:1},{maxValue:99,bucket:5},{maxValue:499,bucket:10},{maxValue:1999,bucket:50}];function create(sizeId,cpm){var index=0,tier=2000;while(cpmBuckets[index]&&cpm>cpmBuckets[index].maxValue){index+=1;}
if(cpmBuckets[index]){tier=math.getBucket(cpm,cpmBuckets[index].bucket);}
tier=Math.max(0,parseInt(tier,10));return sizeId+'_tier'+math.leftPad(tier,4);}
function parsePrice(tier){var matches=/^\d+_tier(\d+)/g.exec(tier);if(matches&&matches[1]){return parseInt(matches[1],10);}
return 0;}
return{create:create,parsePrice:parsePrice};});;define('ext.wikia.adEngine.lookup.rubicon.rubiconVulcan',['ext.wikia.adEngine.lookup.lookupFactory','ext.wikia.adEngine.lookup.rubicon.rubiconTargeting','ext.wikia.adEngine.lookup.rubicon.rubiconTier','wikia.document','wikia.log','wikia.window'],function(factory,rubiconTargeting,rubiconTier,doc,log,win){'use strict';var accountId=7450,config={oasis:{INCONTENT_LEADERBOARD:{siteId:55412,size:[640,480],sizeId:203,targeting:{loc:'hivi'},zoneId:260296},TOP_LEADERBOARD:{siteId:55412,size:[640,480],sizeId:203,targeting:{loc:'top'},zoneId:519058}},mercury:{MOBILE_IN_CONTENT:{siteId:55412,size:[640,480],sizeId:203,targeting:{loc:'hivi'},zoneId:563110}}},libraryUrl='//ads.aws.rubiconproject.com/video/vulcan.min.js',logGroup='ext.wikia.adEngine.lookup.rubicon.rubiconVulcan',priceMap={},rubiconVideoTierKey='rpfl_video',slots={},vulcanCpmKey='cpm',vulcanUrlKey='depot_url';function setupTargeting(slotName,slot,skin){var targeting=rubiconTargeting.getTargeting(slotName,skin,'vulcan');Object.keys(targeting).forEach(function(key){slot.targeting[key]=targeting[key];});}
function defineSingleSlot(slotName,slot){var slotDefinition={'account_id':accountId,'site_id':slot.siteId,'size_id':slot.sizeId,'zone_id':slot.zoneId,'width':slot.size[0],'height':slot.size[1],'rand':Math.round(1000000000*Math.random())};Object.keys(slot.targeting).forEach(function(key){slotDefinition['tg_i.'+key]=slot.targeting[key];});log(['defineSlot',slotName,slotDefinition],'debug',logGroup);win.rubiconVulcan.defineSlot(slotName,slotDefinition);}
function defineSlots(skin,onResponse){Object.keys(slots).forEach(function(slotName){setupTargeting(slotName,slots[slotName],skin);defineSingleSlot(slotName,slots[slotName]);});win.rubiconVulcan.run(onResponse);}
function getSlotParams(slotName){var parameters={};parameters[rubiconVideoTierKey]=slots[slotName].sizeId+'_tierNONE';log(['getSlotParams',slotName,parameters],'debug',logGroup);if(priceMap[slotName]){parameters[rubiconVideoTierKey]=priceMap[slotName];}
return parameters;}
function getBestSlotPrice(slotName){var cpm,price;if(priceMap[slotName]){cpm=rubiconTier.parsePrice(priceMap[slotName])/100;price=cpm.toFixed(2).toString();}
return{vulcan:price};}
function encodeParamsForTracking(params){if(!params[rubiconVideoTierKey]){return;}
return params[rubiconVideoTierKey];}
function calculatePrices(){var allSlots=win.rubiconVulcan.getAllSlots();allSlots.forEach(function(slot){var ad=slot.getBestCpm(),slotName=slot.id,sizeId=slots[slotName].sizeId,cpm,tier,vastUrl;log(['onResponse',slotName,ad.status,ad],'debug',logGroup);if(ad.status==='ok'&&ad.type==='vast'){cpm=ad[vulcanCpmKey]||0;tier=rubiconTier.create(sizeId,cpm*100);vastUrl=ad[vulcanUrlKey];log(['VAST ad',slotName,cpm,tier,vastUrl],'debug',logGroup);priceMap[slotName]=tier;}else{priceMap[slotName]=slots[slotName].sizeId+'_tier0000';}});}
function call(skin,onResponse){var script=doc.createElement('script'),node=doc.getElementsByTagName('script')[0];script.type='text/javascript';script.src=libraryUrl;slots=config[skin];script.addEventListener('load',function(){win.rubiconVulcan=win.rubicontag.video;defineSlots(skin,onResponse);});node.parentNode.insertBefore(script,node);}
function getPrices(){return priceMap;}
function isSlotSupported(slotName){return!!slots[slotName];}
return factory.create({logGroup:logGroup,name:'rubicon_vulcan',call:call,calculatePrices:calculatePrices,getBestSlotPrice:getBestSlotPrice,getPrices:getPrices,isSlotSupported:isSlotSupported,encodeParamsForTracking:encodeParamsForTracking,getSlotParams:getSlotParams});});;define('ext.wikia.adEngine.utils.math',[],function(){'use strict';function getBucket(number,bucketSize){return parseInt(number/bucketSize,10)*bucketSize;}
function leftPad(number,offset){var label=number+'';while(label.length<offset){label='0'+label;}
return label;}
return{getBucket:getBucket,leftPad:leftPad};});;


(function(window,document){'use strict';window.optimizelyUniqueExperiment=function(currentExperiment,mutuallyExclusiveExperiments){if(window.optimizelyCachedExperiment){return false;}
var active,currentInCookie,key,allExperiments,result;if(mutuallyExclusiveExperiments){active=mutuallyExclusiveExperiments;}else{active=[];allExperiments=window.optimizely.allExperiments;for(key in allExperiments){if(allExperiments.hasOwnProperty(key)&&('enabled'in allExperiments[key])&&allExperiments[key]){active.push(key);}}}
for(key=0;key<active.length;key++){if(document.cookie.indexOf(active[key])>-1){currentInCookie=active[key];break;}}
currentInCookie=currentInCookie||active[Math.floor(Math.random()*active.length)];result=parseInt(currentInCookie,10)===parseInt(currentExperiment,10);if(result){window.optimizelyCachedExperiment=currentExperiment;}
return result;};})(window,document);;


window.visitorType=(document.cookie.indexOf('__utma')>-1)?'Returning':'New';;